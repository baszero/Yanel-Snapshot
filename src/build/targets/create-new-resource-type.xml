<?xml version="1.0"?>

<project name="create-new-resource-type" default="new-resource-type">
  <description>Create new resource-type</description>

  <target name="new-resource-type" description="Create a new resource-type" depends="init">
    <echo>Create new resource-type from scratch ${yanel.home.dir}/src/resources/from-scratch-resource-template</echo>


    <input message="Please enter the resource-type name (e.g. calendar):" defaultvalue="null" addproperty="new.resource.name"/>
    <input message="Please enter the namespace of this new resource-type (e.g. http://foo.bar/yanel/resource/1.0):" defaultvalue="null" addproperty="new.resource.namespace"/>
    <input message="Please enter a short description of this resource-type:" defaultvalue="null" addproperty="new.resource.description"/>
    <input message="Please enter java package of this resource-type (e.g. org.wyona.yanel.impl.resources):" defaultvalue="null" addproperty="new.resource.java.class.package"/>
    <input message="Please enter java class name of this resource-type (e.g. CalendarResource):" defaultvalue="null" addproperty="new.resource.java.class.name"/>

    <!-- TODO: Generate this path from package and class name! -->
    <input message="Please enter java class filesystem path of this resource-type (e.g. org/wyona/yanel/impl/resources/CalendarResource.java):" defaultvalue="null" addproperty="new.resource.java.class.fs.path"/>

    <property name="new.resource.java.class.location" location="${yanel.home.dir}/src/contributions/resources/${new.resource.name}/src/java/${new.resource.java.class.fs.path}"/>
    <property name="new.resource.java.class" value="${new.resource.java.class.package}.${new.resource.java.class.name}"/>


    <copy todir="${yanel.home.dir}/src/contributions/resources/${new.resource.name}">
      <fileset dir="${yanel.home.dir}/src/resources/from-scratch-resource-template" excludes="build/**,src/java/**"/>
    </copy>

    <!-- Patch resource.xml -->
    <replace file="${yanel.home.dir}/src/contributions/resources/${new.resource.name}/resource.xml" value="${new.resource.name}">
      <replacetoken>from-scratch</replacetoken>
    </replace>
    <replace file="${yanel.home.dir}/src/contributions/resources/${new.resource.name}/resource.xml" value="${new.resource.namespace}">
      <replacetoken>http://foo.bar/yanel/resource/1.0</replacetoken>
    </replace>
    <replace file="${yanel.home.dir}/src/contributions/resources/${new.resource.name}/resource.xml" value="${new.resource.description}">
      <replacetoken>From Scratch Resource Template</replacetoken>
    </replace>
    <replace file="${yanel.home.dir}/src/contributions/resources/${new.resource.name}/resource.xml" value="${new.resource.java.class}">
      <replacetoken>bar.foo.yanel.impl.resources.FromScratchResource</replacetoken>
    </replace>

    <!-- Patch doc/index.html -->
    <replace file="${yanel.home.dir}/src/contributions/resources/${new.resource.name}/yanel-htdocs/doc/index.html" value="${new.resource.name}">
      <replacetoken>from-scratch</replacetoken>
    </replace>
    <replace file="${yanel.home.dir}/src/contributions/resources/${new.resource.name}/yanel-htdocs/doc/index.html" value="${new.resource.namespace}">
      <replacetoken>http://foo.bar/yanel/resource/1.0</replacetoken>
    </replace>
    <replace file="${yanel.home.dir}/src/contributions/resources/${new.resource.name}/yanel-htdocs/doc/index.html" value="${new.resource.description}">
      <replacetoken>From Scratch Resource Template</replacetoken>
    </replace>
    <replace file="${yanel.home.dir}/src/contributions/resources/${new.resource.name}/yanel-htdocs/doc/index.html" value="${new.resource.java.class}">
      <replacetoken>bar.foo.yanel.impl.resources.FromScratchResource</replacetoken>
    </replace>

    <!-- Patch build.properties -->
    <replace file="${yanel.home.dir}/src/contributions/resources/${new.resource.name}/src/build/build.properties" value="${new.resource.name}">
      <replacetoken>from-scratch</replacetoken>
    </replace>

    <echo>${new.resource.java.class}</echo>
    <copy file="${yanel.home.dir}/src/resources/from-scratch-resource-template/src/java/bar/foo/yanel/impl/resources/FromScratchResource.java" tofile="${new.resource.java.class.location}"/>
    <replace file="${new.resource.java.class.location}" value="${new.resource.java.class.name}">
      <replacetoken>FromScratchResource</replacetoken>
    </replace>
    <replace file="${new.resource.java.class.location}" value="${new.resource.java.class.package}">
      <replacetoken>bar.foo.yanel.impl.resources</replacetoken>
    </replace>
  </target>
</project>
