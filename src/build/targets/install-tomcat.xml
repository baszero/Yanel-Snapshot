<?xml version="1.0"?>

<project name="install-default-tomcat" default="install-default-tomcat" xmlns:artifact="antlib:org.apache.maven.artifact.ant">
  <description>Install Default Tomcat</description>
  
  <target name="install-default-tomcat" description="Install Default Tomcat" depends="init" if="yes.install.default.tomcat">
    <echo>Install Default Tomcat ...</echo>

    <artifact:remoteRepository id="wyona.org.remote.repository" url="${maven.url}"/>

    <artifact:dependencies pathId="maven2.tomcat.classpath" filesetId="maven2.tomcat.fileset">
      <remoteRepository refid="wyona.org.remote.repository"/>
      <dependency groupId="apache-org" artifactId="apache-tomcat" version="${tomcat.version}" scope="provided"/>
    </artifact:dependencies>

<!-- DEBUG
    <property name="prop.maven2.tomcat.fileset" refid="maven2.tomcat.fileset"/>
    <echo>Refid: ${prop.maven2.tomcat.fileset}</echo>
-->

    <mkdir dir="${yanel.source.home}/local"/>
    <unzip dest="${yanel.source.home}/local">
      <fileset refid="maven2.tomcat.fileset"/>
    </unzip>
    <chmod perm="755">
      <fileset dir="${default.tomcat.home.dir}/bin">
        <include name="*.sh"/>
      </fileset>
    </chmod>
    <delete dir="${yanel.source.home}/local/META-INF"/>

    <condition property="isJava1.4">
      <equals arg1="${ant.java.version}" arg2="1.4"/>
    </condition>
    <antcall target="copy-java1.4-libs"/>
    
    <replace file="${yanel.source.home}/src/build/local.build.properties" value="tomcat1.http.port=8080">
      <replacetoken>#tomcat1.http.port=9190</replacetoken>
    </replace>
    <replace file="${yanel.source.home}/src/build/local.build.properties" value="tomcat1.ssl.port=8443">
      <replacetoken>#tomcat1.ssl.port=9143</replacetoken>
    </replace>
  </target>
  
  <target name="copy-java1.4-libs" if="isJava1.4" description="Copy jars specific to java 1.4" depends="init">
    <copy file="${yanel.source.home}/tools/apache-tomcat/java-1.4/apache-tomcat-${tomcat.version}/bin/jmx.jar" todir="${default.tomcat.home.dir}/bin"/>
  </target>
    
</project>
